"use strict";(()=>{var r={};r.id=815,r.ids=[815],r.modules={517:r=>{r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3685:r=>{r.exports=require("http")},5687:r=>{r.exports=require("https")},5477:r=>{r.exports=require("punycode")},2781:r=>{r.exports=require("stream")},7310:r=>{r.exports=require("url")},9796:r=>{r.exports=require("zlib")},8343:(r,e,t)=>{t.r(e),t.d(e,{headerHooks:()=>g,originalPathname:()=>j,patchFetch:()=>I,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>f,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>m});var a={};t.r(a),t.d(a,{DELETE:()=>u,PUT:()=>c});var s=t(884),o=t(6132),i=t(1040),d=t(5798),n=t(1762);async function u(r,{params:e}){try{let t=r.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return d.Z.json({error:"Unauthorized"},{status:401});let a=t.split(" ")[1],{data:{user:s},error:o}=await n.O.auth.getUser(a);if(o||!s)return d.Z.json({error:"Invalid token"},{status:401});let i=e.id,{data:u,error:c}=await n.O.from("cards").select("*").eq("id",i).eq("user_id",s.id).single();if(c){if("PGRST116"===c.code)return d.Z.json({error:"Card not found"},{status:404});return console.error("Database error:",c),d.Z.json({error:"Failed to fetch card"},{status:500})}let{error:l}=await n.O.from("cards").delete().eq("id",i).eq("user_id",s.id);if(l)return console.error("Database error:",l),d.Z.json({error:"Failed to delete card"},{status:500});return d.Z.json({message:"Card deleted successfully",deleted_card:u})}catch(r){return console.error("API error:",r),d.Z.json({error:"Internal server error"},{status:500})}}async function c(r,{params:e}){try{let t=r.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return d.Z.json({error:"Unauthorized"},{status:401});let a=t.split(" ")[1],{data:{user:s},error:o}=await n.O.auth.getUser(a);if(o||!s)return d.Z.json({error:"Invalid token"},{status:401});let i=e.id,u=await r.json(),{card_name:c,network:l,card_last4:p}=u;if(!c||!l||!p)return d.Z.json({error:"card_name, network, and card_last4 are required"},{status:400});if(!/^\d{4}$/.test(p))return d.Z.json({error:"card_last4 must be exactly 4 digits"},{status:400});let{data:h,error:f}=await n.O.from("cards").select("*").eq("id",i).eq("user_id",s.id).single();if(f){if("PGRST116"===f.code)return d.Z.json({error:"Card not found"},{status:404});return console.error("Database error:",f),d.Z.json({error:"Failed to fetch card"},{status:500})}let{data:g,error:m}=await n.O.from("cards").update({card_name:c,network:l,card_last4:p,updated_at:new Date().toISOString()}).eq("id",i).eq("user_id",s.id).select().single();if(m)return console.error("Database error:",m),d.Z.json({error:"Failed to update card"},{status:500});return d.Z.json({card:g,message:"Card updated successfully"})}catch(r){return console.error("API error:",r),d.Z.json({error:"Internal server error"},{status:500})}}let l=new s.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/cards/[id]/route",pathname:"/api/cards/[id]",filename:"route",bundlePath:"app/api/cards/[id]/route"},resolvedPagePath:"/Users/ashishshekhawat/Desktop/wisor-credit-optimizer/wisor-web-app/src/app/api/cards/[id]/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:f,headerHooks:g,staticGenerationBailout:m}=l,j="/api/cards/[id]/route";function I(){return(0,i.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:h})}},1762:(r,e,t)=>{t.d(e,{O:()=>s});var a=t(8935);let s=(0,a.eI)("https://gpqdzgfnkepeexdgtrda.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdwcWR6Z2Zua2VwZWV4ZGd0cmRhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5NjAxOTgsImV4cCI6MjA3NDUzNjE5OH0.4iOn2YvvBREMPOF-NHk3X3t2OxgPrz9gm2UJVg3RapU")}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),a=e.X(0,[271,350],()=>t(8343));module.exports=a})();